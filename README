------------------------------------------------------------------------------
------------------------------------------------------------------------------
DrayTek V2xxx config file and firmware decryption/decompression tools
------------------------------------------------------------------------------
------------------------------------------------------------------------------
draytools Copyright (C) AMMOnium <ammonium at mail dot ru>
  
    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.

------------------------------------------------------------------------------
This program uses code translated from Java code of Java-LZO compression 
program by Markus Oberhumer, author of LZO algorithm and its implementation:

http://www.oberhumer.com/opensource/lzo/


   Copyright (C) 1999 Markus Franz Xaver Johannes Oberhumer
   Copyright (C) 1998 Markus Franz Xaver Johannes Oberhumer
   Copyright (C) 1997 Markus Franz Xaver Johannes Oberhumer
   Copyright (C) 1996 Markus Franz Xaver Johannes Oberhumer

   The LZO library is free software; you can redistribute it and/or
   modify it under the terms of the GNU General Public License as
   published by the Free Software Foundation; either version 2 of
   the License, or (at your option) any later version.

   The LZO library is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.

   You should have received a copy of the GNU General Public License
   along with the LZO library; see the file COPYING.
   If not, write to the Free Software Foundation, Inc.,
   59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.

   Markus F.X.J. Oberhumer
   <markus.oberhumer@jk.uni-linz.ac.at>
   http://wildsau.idv.uni-linz.ac.at/mfx/lzo.html

------------------------------------------------------------------------------
------------------------------------------------------------------------------
1. Introduction
------------------------------------------------------------------------------
------------------------------------------------------------------------------
1.1. The problem.
------------------------------------------------------------------------------
Modern DrayTek Vigor routers (V2xxx models, e.g. 2710, 2820, 2930 etc.) 
compress and enrypt their configuration files, and their firmware is 
compressed also. 

The router's owner may forget the admin password one day.
Resetting the device to factory settings may not be an option, e.g. if 
some complex network configuration has been done.


If so, draytools are here to help.


In short, how the config file is compressed and encrypted:

Config file:
    1) take raw slice of memory of about 300 K
    2) compress with lzo 1.08
    3) take router model number, with leading uppercase "V", e.g. "V2710" 
       and compute 1-byte sum of its raw bytes. It will be the key
    4) pseudocode for encryption

    for each byte b in data:
        b = b XOR key
        b = b - key
        b = swap (3 right bits of b) and (5 left bits of b)

    5) add 0x100-byte header
To uncompress, simply reverse the operations.


Firmware:
	1) compress
	2) add 0x100-byte header with magic signature
	3) add compressed FS image to the end
------------------------------------------------------------------------------
1.2. Features.
------------------------------------------------------------------------------
1.2.1. Decrypt Draytek config files
1.2.2. Decompress Draytek config files
1.2.3. Print admin login & password from config files
------------------------------------------------------------------------------
1.3. List of supported routers 
------------------------------------------------------------------------------

All DrayTek Vigor 2xxx routers should be supported!

Config file operations tested on:
  2710
  2820
  2830
  2910

Firmware operations tested on:
  2710
  2800
  2820
  2830
  2900
  2910
  2920
  2930
  2950    	
  2955

------------------------------------------------------------------------------
------------------------------------------------------------------------------
2. Installation and usage
------------------------------------------------------------------------------
------------------------------------------------------------------------------
2.1. Get Python (2.5 or newer)
2.2. Execute

# python draytools.py --help

and have fun.
2.3. Or even use draytools.py & pydelzo.py in your projects (GPL v3).

------------------------------------------------------------------------------
------------------------------------------------------------------------------
3. Known BUGs and other notes
------------------------------------------------------------------------------
------------------------------------------------------------------------------
3.1. Input is not validated, many stupid default assumptions are being made.
------------------------------------------------------------------------------
4. TODOs
------------------------------------------------------------------------------
4.1. Further research of config file format
4.2. Further research of firmware file format
4.3. Try building custom firmware
------------------------------------------------------------------------------
